language: python
sudo: false
dist: trusty

python:
- '2.7'
- '3.5'

cache: apt

before_install:
    - wget http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
    - bash miniconda.sh -b -p $HOME/miniconda
    - export PATH="$HOME/miniconda/bin:$PATH"
    - conda update --yes conda

install:
    - conda install --yes python=$TRAVIS_PYTHON_VERSION pip numpy anaconda-client anaconda-build
    - aclocal
    - autoheader
    - libtoolize
    - touch INSTALL NEWS README AUTHORS
    - automake -acf
    - autoconf
    - ./configure
    - make check # test in C
    - cd python
    - pwd
    - git branch -v
    - git describe --tags --dirty
    - ./get_nanoversion.sh
    - cat __nanoversion__.txt
    - ln -s ../src .
    - python setup.py install 

script:
    - cd test
    - python test_spglib.py
    - cd ..

deploy:
    # testing pypi
    # secure: "JBSrOM59mYHCInktXcbERawSb1cbEVkAAoY4Fq9xdXQfZgkrQQDrEKvsm3neH9RNUr66DvfNk4UDjil5xWF0hJTPoX0UAu7gHRuGnnsXwSwgvCMQ37/FvZnMXZp7zA7w0VfPEjK4FWcYincioqS6AewPsJaF4Dsp4W/bnIomZ3EhASvNn1oj7vqlhXhACGA9ZhZNROurhfqaUChSuefe7ze7idfKhJX0bhS5U+DGCaED8EdYRCQHaekbwy+WAin2YQIMxbxCsdoBoaoaTtUoR+k//O6/Jjb2QzsFgnP3JwCG9GlohyVOeBJlnLHkM7zGhfE4yzr1f4i8o6pePXKOhiZ0CjMVA6zQlMl4Aqe6vzAF00lOySV8radtXWI8Aevx0A1Z2diSMrTjnSWAglKph3vJGM1jzvEEc3M7shij0b3IfqohAT2M8oUPHE81MnhlVKf6QdkIy04eCi/ne3L2zTyTvILz1JMnnKSSbSH9vgZIaKDBtRz56lZmsDdhmCs9HlzB7uQNVTpmNRhPudiREMBFsh/OmqL0d9WsbalXaYVljlunHpuAVJKQynX2CEvyeOxELpjWU1W9mbItFqvXdnXHMX8eYLK6RYlJp5DR/QS3Ev6ldY6cURqj0EsL0RZxEwR02+pyiT6CC8ZtCC/isAKoQvHxKHwI0OG2y6z0i8Y="
    - provider: pypi
      server: https://testpypi.python.org/pypi
      skip_cleanup: true
      distributions: sdist
      user: $TEST_PYPI_USER
      password:
          secure: "$TEST_PYPI_TOKEN"
      on:
        repo: atztogo/spglib
        branch: rc
        tags: false
    
    # testing conda
    - provider: script
      skip_cleanup: true
      script: conda/anaconda_deploy.sh rc $ANACONDA_TOKEN $TRAVIS_BRANCH
      on:
        repo: atztogo/spglib
        branch: rc
        tags: false

    # production pypi
    - provider: pypi
      skip_cleanup: true
      distributions: sdist
      user: atztogo
      password:
          secure: "sjUxbFSrhflB/NqMwcJCmalmQRX1EN4zgsK2YyY93JEk16aep+5pRyV87Q3Q54L19PGOkTqOrGyvUhwxTHUweo87F2DM1gd695bg0rROcquvhwWxlTuhMhMoUGSxDljgKbEeTvLikFd91JX2Rr/deIZLog/c3z/m55MbgHqGoyR5p1twxqLoUcJHznM8Mnn/KTauVHVQKG/6sVQr/h9AhRB8qI5VRCcrnDqAWoePqkgibWjEKchx/lmgW4TiB15IIvmIVgMxNwUa2q91Lqn3AhZDOcB/TST34yZCx8j1TpLJgAtB8+aRnTdmtfhnPWN8gebVuHJni+EQYsq4sIOiRzsU5qHkCzmW2x6I/kcTTYWYW4KybKorWQcypotTkyDoSfFuhZ93kyMy6QXBdV0/3xskBAbA++Mc93u6KaNMDnBGLb9PoeIT6R6YRNnwDAYBSlJ8lMZoNwVKrPhxI11r15eAK/4NamUHSLORBJWYKw1Z1Ko5wjkMXTSC4y7rC5UD+wrgZCfhB7WBLvatGBA3oD83dmEzMl3zA3wyaegDqHbEzKIFCGX5/eKrVN91hQrvlFkVYwf7YHAcNTvplZi0EGotfuZVsyhHiYSXRrMdF16g/NyZwunMEydafsbbwQatLxMhCMufX+5B1bk8VsmM0QDI9EV3rdvC7vgpnO5KPpY="
      on:
        repo: atztogo/spglib
        branch: master
        tags: false

    # production anaconda
    - provider: script
      skip_cleanup: true
      script: conda/anaconda_deploy.sh main $ANACONDA_TOKEN $TRAVIS_BRANCH
      on:
        repo: atztogo/spglib
        branch: master
        tags: false
